{"ast":null,"code":"var _jsxFileName = \"/home/gleb/my_app_test/src/audio/AudioPlayer.tsx\",\n  _s = $RefreshSig$();\n// AudioPlayer.tsx\nimport React, { useRef, useEffect, useState } from 'react';\nimport { useAudio } from './AudioContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AudioPlayer = () => {\n  _s();\n  const {\n    currentAudioUrl\n  } = useAudio();\n  const audioContextRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  useEffect(() => {\n    audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\n    return () => {\n      var _audioContextRef$curr;\n      (_audioContextRef$curr = audioContextRef.current) === null || _audioContextRef$curr === void 0 ? void 0 : _audioContextRef$curr.close();\n    };\n  }, []);\n  const playAudio = async () => {\n    if (!audioContextRef.current) return;\n    if (sourceNodeRef.current) {\n      sourceNodeRef.current.stop();\n    }\n    const response = await fetch(currentAudioUrl);\n    const arrayBuffer = await response.arrayBuffer();\n    const audioBuffer = await audioContextRef.current.decodeAudioData(arrayBuffer);\n    sourceNodeRef.current = audioContextRef.current.createBufferSource();\n    sourceNodeRef.current.buffer = audioBuffer;\n    sourceNodeRef.current.connect(audioContextRef.current.destination);\n    const analyser = audioContextRef.current.createAnalyser();\n    sourceNodeRef.current.connect(analyser);\n    sourceNodeRef.current.start();\n    setIsPlaying(true);\n    drawOscilloscope(analyser);\n  };\n  const drawOscilloscope = analyser => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const canvasCtx = canvas.getContext('2d');\n    if (!canvasCtx) return;\n    const draw = () => {\n      const WIDTH = canvas.width;\n      const HEIGHT = canvas.height;\n      analyser.fftSize = 2048;\n      const bufferLength = analyser.fftSize;\n      const dataArray = new Uint8Array(bufferLength);\n      canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);\n      const drawVisual = requestAnimationFrame(draw);\n      analyser.getByteTimeDomainData(dataArray);\n      canvasCtx.lineWidth = 2;\n      canvasCtx.strokeStyle = 'rgb(0, 255, 0)';\n      canvasCtx.beginPath();\n      const sliceWidth = WIDTH * 1.0 / bufferLength;\n      let x = 0;\n      for (let i = 0; i < bufferLength; i++) {\n        const v = dataArray[i] / 128.0;\n        const y = v * HEIGHT / 2;\n        if (i === 0) {\n          canvasCtx.moveTo(x, y);\n        } else {\n          canvasCtx.lineTo(x, y);\n        }\n        x += sliceWidth;\n      }\n      canvasCtx.lineTo(canvas.width, canvas.height / 2);\n      canvasCtx.stroke();\n    };\n    draw();\n  };\n  const stopAudio = () => {\n    if (sourceNodeRef.current) {\n      sourceNodeRef.current.stop();\n      setIsPlaying(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: isPlaying ? stopAudio : playAudio,\n      children: isPlaying ? 'Stop' : 'Play'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      width: \"800\",\n      height: \"200\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n};\n_s(AudioPlayer, \"/4x+V1z9fk+5YuXzBy3A8VFFycQ=\", false, function () {\n  return [useAudio];\n});\n_c = AudioPlayer;\nexport default AudioPlayer;\nvar _c;\n$RefreshReg$(_c, \"AudioPlayer\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useAudio","jsxDEV","_jsxDEV","AudioPlayer","_s","currentAudioUrl","audioContextRef","sourceNodeRef","canvasRef","isPlaying","setIsPlaying","current","window","AudioContext","webkitAudioContext","_audioContextRef$curr","close","playAudio","stop","response","fetch","arrayBuffer","audioBuffer","decodeAudioData","createBufferSource","buffer","connect","destination","analyser","createAnalyser","start","drawOscilloscope","canvas","canvasCtx","getContext","draw","WIDTH","width","HEIGHT","height","fftSize","bufferLength","dataArray","Uint8Array","clearRect","drawVisual","requestAnimationFrame","getByteTimeDomainData","lineWidth","strokeStyle","beginPath","sliceWidth","x","i","v","y","moveTo","lineTo","stroke","stopAudio","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","ref","_c","$RefreshReg$"],"sources":["/home/gleb/my_app_test/src/audio/AudioPlayer.tsx"],"sourcesContent":["// AudioPlayer.tsx\nimport React, { useRef, useEffect, useState } from 'react';\nimport { useAudio } from './AudioContext';\n\nconst AudioPlayer: React.FC = () => {\n  const { currentAudioUrl } = useAudio();\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const sourceNodeRef = useRef<AudioBufferSourceNode | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  useEffect(() => {\n    audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    return () => {\n      audioContextRef.current?.close();\n    };\n  }, []);\n\n  const playAudio = async () => {\n    if (!audioContextRef.current) return;\n\n    if (sourceNodeRef.current) {\n      sourceNodeRef.current.stop();\n    }\n\n    const response = await fetch(currentAudioUrl);\n    const arrayBuffer = await response.arrayBuffer();\n    const audioBuffer = await audioContextRef.current.decodeAudioData(arrayBuffer);\n\n    sourceNodeRef.current = audioContextRef.current.createBufferSource();\n    sourceNodeRef.current.buffer = audioBuffer;\n    sourceNodeRef.current.connect(audioContextRef.current.destination);\n\n    const analyser = audioContextRef.current.createAnalyser();\n    sourceNodeRef.current.connect(analyser);\n\n    sourceNodeRef.current.start();\n    setIsPlaying(true);\n\n    drawOscilloscope(analyser);\n  };\n\n  const drawOscilloscope = (analyser: AnalyserNode) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const canvasCtx = canvas.getContext('2d');\n    if (!canvasCtx) return;\n\n    const draw = () => {\n      const WIDTH = canvas.width;\n      const HEIGHT = canvas.height;\n\n      analyser.fftSize = 2048;\n      const bufferLength = analyser.fftSize;\n      const dataArray = new Uint8Array(bufferLength);\n\n      canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);\n\n      const drawVisual = requestAnimationFrame(draw);\n\n      analyser.getByteTimeDomainData(dataArray);\n\n      canvasCtx.lineWidth = 2;\n\n      canvasCtx.strokeStyle = 'rgb(0, 255, 0)';\n      canvasCtx.beginPath();\n\n      const sliceWidth = WIDTH * 1.0 / bufferLength;\n      let x = 0;\n\n      for (let i = 0; i < bufferLength; i++) {\n        const v = dataArray[i] / 128.0;\n        const y = v * HEIGHT / 2;\n\n        if (i === 0) {\n          canvasCtx.moveTo(x, y);\n        } else {\n          canvasCtx.lineTo(x, y);\n        }\n\n        x += sliceWidth;\n      }\n\n      canvasCtx.lineTo(canvas.width, canvas.height / 2);\n      canvasCtx.stroke();\n    };\n\n    draw();\n  };\n\n  const stopAudio = () => {\n    if (sourceNodeRef.current) {\n      sourceNodeRef.current.stop();\n      setIsPlaying(false);\n    }\n  };\n\n  return (\n    <div>\n      <button onClick={isPlaying ? stopAudio : playAudio}>\n        {isPlaying ? 'Stop' : 'Play'}\n      </button>\n      <canvas ref={canvasRef} width=\"800\" height=\"200\" />\n    </div>\n  );\n};\n\nexport default AudioPlayer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}